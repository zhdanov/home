project: {{ env "appname" }}
configVersion: 1
deploy:
  namespace: {{ env "appname" }}-{{ env "environment" }}
  namespaceSlug: false

---
image: {{ env "appname" }}-nginx
from: nginx:1.18.0-alpine

---
image: {{ env "appname" }}-php-fpm
from: php:7.4.13-fpm-alpine3.12
docker:
  USER: root
  WORKDIR: /var/www/html
  EXPOSE: "9000"
ansible:
  beforeInstall:
  - name: install packages for php-fpm
    shell: apk add --no-cache libc-dev autoconf make gcc g++ bash vim zip libzip-dev libpng-dev jpeg-dev openssh git php7-dev
  - name:  install php-extentions
    shell: |
      docker-php-ext-configure gd --with-jpeg
      docker-php-ext-install -j$(nproc) gd zip pdo_mysql mysqli
  - name: install php config
    shell: |
      cp /usr/local/etc/php/php.ini-production /usr/local/etc/php/php.ini
  - name:  ssh_config for github
    shell: printf "Host github.com\n\tStrictHostKeyChecking no\n\tUserKnownHostsFile=/dev/null\n" >> /etc/ssh/ssh_config

---
image: {{ env "appname" }}-mongodb
from: mongo:4.4.2-bionic

---
image: {{ env "appname" }}-mariadb
from: mariadb:10.5.8-focal
