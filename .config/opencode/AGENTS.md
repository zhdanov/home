Всегда задавай вопросы с вариантами выбора (options) вместо текстовых ответов пользователю.

Always use Context7 MCP when I need library/API documentation, code generation, setup or configuration steps without me having to explicitly ask.

## Режимы работы

- Никогда НЕ переключайся автоматически из Plan-режима в Build-режим
- В Plan-режиме можешь только планировать и анализировать
- Переход в Build-режим возможен ТОЛЬКО после явного указания пользователя (например: "начинай", "выполняй", "действуй", "go", "do it")
- Всегда спрашивай подтверждение перед переходом в Build-режим, если пользователь явно не указал действовать

## Notification / Уведомление на каждый ответ ассистента (commit hook)

**Цель:** email-уведомление должно отправляться **перед каждым пользовательским сообщением ассистента**, независимо от ветки выполнения (обычный ответ, уточнение, отказ, ошибка, короткий ответ, финализация после инструментов и т.д.).

---

### Обязательное правило

- Перед тем как ассистент выведет любой user-visible текст пользователю, он обязан отправить email-уведомление через джобу `jobber__send_notification.job`.
- Это должно быть **последнее действие перед отправкой ответа пользователю** (аналог pre-send / commit hook).
- Делать это **ровно один раз на одно сообщение ассистента** (даже если в сообщении несколько пунктов или вопросов).
- Правило распространяется на:
  - уточняющие вопросы,
  - сообщения об ошибке,
  - отказы,
  - короткие ответы,
  - финальные сообщения после выполнения инструментов.

---

### Plan-режим

- В **Plan-режиме** отправка уведомления **разрешена и обязательна**.
- План, промежуточный план, уточняющий план и финализированный план считаются обычным пользовательским сообщением ассистента.
- Для каждого сообщения в Plan-режиме уведомление отправляется на общих основаниях (один раз перед отправкой текста пользователю).

---

### Обязательный алгоритм

1. Сформировать финальный текст ответа (не отправляя его пользователю).
2. Непосредственно перед отправкой выполнить команду уведомления.
3. Команда должна вызываться строго один раз.
4. Если `/usr/local/bin/run` недоступен — уведомление пропускается (без ошибок).
5. После попытки вызова — отправить ответ пользователю.

---

### Команда запуска (глобальная, с логированием)

```bash
[ -x /usr/local/bin/run ] && /usr/local/bin/run --name=jobber__send_notification.job --data='{"echo":false}'
```

- Если /usr/local/bin/run недоступен — ничего не делать.
- Дополнительно можно передать параметр machine_name (string), иначе джоба использует hostname.
- Если по какой-либо причине команда не была вызвана (логическая ошибка, ранний return, исключение до вызова и т.п.), ассистент обязан добавить в начало ответа строку:
[notification: failed]

### Ограничения

- Нельзя привязывать уведомление только к состоянию бездействия (idle).
- Нельзя отправлять пользователю часть ответа до выполнения команды уведомления.
- Нельзя пропускать уведомление из-за типа ответа (вопрос, ошибка, отказ и т.д.).
